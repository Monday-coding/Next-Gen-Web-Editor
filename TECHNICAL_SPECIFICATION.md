# Next-Gen Web Editor - Technical Specification
# 下一代網頁編輯器 - 技術規格

## 📝 **項目概覽**
- **項目名稱**：Next-Gen Web Editor
- **項目目標**：開發一個比 Rich Text Editor 更好用的 Web 編輯器
- **平台**：網頁

---

## 🛠 **技術棧**

### 1. 核心框架
- **React 18**：現代化前端框架，支持並發特性。
- **TypeScript**：強類型語言，確保代碼質量。
- **Vite**：現代化、極速的構建工具（比 CRA/Webpack 快很多）。

### 2. UI 框架
- **MUI (Material UI) v5**：基於 Material Design 的 React 組件庫。
  - **為何選 MUI**：
    - 完美支持 React 18。
    - 組件極其豐富（Grid, Tabs, Button, Dialog 等）。
    - 內置 Dark Mode 極感。
    - 組件性能優異（優於 AntD 和 Chakra UI）。
    - 文檔完善，社區活躍。

### 3. 狀態管理
- **Zustand**：輕量級、無需 Boilerplate 的狀態管理方案。
  - **為何選 Zustand**：
    - 比 Redux Toolkit 更簡單，API 更直觀。
    - 性能更好（優化的 React 18 並發模式）。
    - Bundle 更小（減少首屏加載時間）。
    - 更適合編輯器這類狀態複雜的應用。

### 4. 核心引擎：富文本編輯器
- **Tiptap**：基於 ProseMirror 的現代化、模塊化富文本框架。
  - **為何選 Tiptap**：
    - **現代化**：API 設計現代，支持 Hooks，符合 React 18 最佳實踐。
    - **模塊化**：可以按需導入擴展（如表格、圖片、代碼塊、對齊），減少包大小。
    - **協作支持**：內置對 Yjs 和 Liveblocks 的支持，易於實現實時協作。
    - **Markdown 支持**：完美的 Markdown 支持（導入/導出）。
    - **性能優異**：基於 ProseMirror，渲染性能和編輯流暢度是業界頂級的。
    - **擴展性**：開發者可以自定義渲染、擴展節點、添加自定義菜單。
    - **生態成熟**：Notion、GitHub Linear 等知名產品都使用 Tiptap 或 ProseMirror。

### 5. 代碼高亮與語言支持
- **Prism.js** 或 **Shiki**：
  - 用於語法高亮顯示代碼塊。
  - 支持語言：Python, JavaScript, TypeScript, Java, C++, Go, Rust 等。

### 6. 協作與實時（可選，若需要協作）
- **Yjs**：
  - 用於實時協作（CRDT - 冲突解決算法）。
  - 多人同時編輯同一文檔，無鎖衝突。
- **Liveblocks**：
  - 基於 Yjs 的全功能協作平台開發工具。
  - 提供實時協作（光標、用戶在線狀態、評論）。
  - 提供存儲、權限管理、Webhooks。

### 7. 部署與平台
- **Vercel**：
  - React 和 Next.js 的首選部署平台。
  - 提供 CI/CD、預覽、回滾等功能。
  - 支持邊緣函數。
  - 全球 CDN。
- **Netlify**：也是一個非常優秀的備選方案。

---

## 🎨 **功能規劃**

### 1. 核心編輯功能 (超越傳統)
- **格式化**：
  - 支持標題（H1-H6）、加粗、斜體、下劃線、列表（有序/無序）、引用。
  - 支持快捷鍵（例如：Cmd/Ctrl + B 加粗，Cmd/Ctrl + K 插入鏈接）。
  - 支持清除格式。
- **代碼塊**：
  - 支持行號。
  - 支持語法高亮（多語言）。
  - 支持代碼塊折疊。
  - 支持複製代碼（一鍵複製）。
- **媒體嵌入**：
  - 支持圖片（從本地拖放或 URL 粘貼）。
  - 支持調整圖片大小、對齊、替代文字。
  - 支持視頻嵌入。
  - 支持音頻嵌入。
- **高級塊級操作**：
  - 支援引塊、分欄塊。
  - 支援嵌入頁面、分頁符。
- **Markdown 寫作模式**：
  - 支持 Markdown 語寫，即時預覽。
  - 支持 Markdown 與富文本的切換（雙向同步）。
- **導出/導入**：
  - 導出 Markdown。
  - 導出 HTML。
  - 導出 PDF（高質量）。
  - 導出 JSON。

### 2. 協作與版本控制 (超越傳統)
- **實時協作** (使用 Yjs + Liveblocks)：
  - 多人同時編輯（光標顯示）。
  - 實時用戶狀態（誰在線，正在編輯什麼）。
  - 衝突解決（Yjs 自動處理，無需手動合併）。
  - 註論功能（對文檔的特定部分進行評論）。
- **版本歷史**：
  - 無限的版本歷史（基於後端）。
  - 實時保存（每次輸入自動保存）。
  - 視圖歷史 (Diff View)：比較不同版本的差異。
  - 回滾/復原功能。

### 3. 產品體驗優化
- **性能優化**：
  - 虛擬渲染 (Virtual Scrolling)：對於超長文檔，只渲染可見區域，確保編輯流暢度。
  - 代碼分割：使用動態導入，減少首屏加載時間。
- **響應式設計**：
  - 支持桌面端、平板、手機。
  - 桌面版適配大屏幕，充分利用屏幕空間。
- **無障礙體驗 (Accessibility)**：
  - 完整支持鍵盤操作。
  - 支持屏幕閱讀器。
  - 遵循 WCAG 2.1 標準。
- **本地化 (L10n)**：
  - 支持多語言（中文、英文等）。
  - 支持 RTL（從右到左）語言。

---

## 🗂 **架構設計**

### 1. 整體架構
- **前端**：React 18 + TypeScript + MUI + Vite
- **編輯器核心**：Tiptap + ProseMirror
- **狀態管理**：Zustand
- **實時協作**：Yjs + Liveblocks (可選)

### 2. 數據流程 (前端 -> 協作後端 -> 前端)
1. **前端**：用戶輸入數據 -> 更新本地狀態 -> 發送到後端。
2. **協作後端**：接收更新 -> 廣用 Yjs 處理衝突 -> 廣用 Yjs 處理存儲 -> 推送到客戶端。
3. **前端**：接收更新 -> 更新 UI。

### 3. 部署架構
- **Vercel Edge Network**：
  - 全球 CDN 分發。
  - 智能路由（根據地理位置分配最近的節點）。
  - 圖片優化和壓縮。

---

## 📋 **開發計劃**

### Phase 0: 項目初始化與環境搭建 (Day 1)
- [ ] 創建 Vite + React 18 + TypeScript 項目。
- [ ] 安裝 MUI v5。
- [ ] 安裝 Zustand。
- [ ] 安裝 Tiptap 及其依賴。
- [ ] 配置 Prettier、ESLint。
- [ ] 配置 Git。

### Phase 1: 基礎 UI 搭建 (Day 2-3)
- [ ] 實現 App 主佈局（Sidebar, Main Area, Topbar）。
- [ ] 實現文件管理 (新建文件、重命名、刪除、文件樹)。
- [ ] 實現主題切換。

### Phase 2: Tiptap 集成與核心編輯 (Day 4-6)
- [ ] 集成 Tiptap 核心編輯器。
- [ ] 配置基本工具欄（加粗、斜體、列表等）。
- [ ] 實現工具提示。
- [ ] 實現快捷鍵。
- [ ] 實現菜單。

### Phase 3: 高級塊與媒體 (Day 7-9)
- [ ] 實現代碼塊。
- [ ] 實現圖片上傳、調整、插入。
- [ ] 實現表格。
- [ ] 實現引用。

### Phase 4: Markdown 與協作 (Day 10-14)
- [ ] 集成 Tiptap 的 Markdown 支持。
- [ ] 實現導出功能。
- [ ] (可選) 集成 Liveblocks。
- [ ] (可選) 實現實時協作。

### Phase 5: 性能優化與體驗打磨 (Day 15-17)
- [ ] 實現虛擬滾動。
- [ ] 運行代碼分割。
- [ ] 優化首屏加載。
- [ ] 無障礙體驗優化。
- [ ] 全瀏覽器兼容性測試。

### Phase 6: 部署與發布 (Day 18-20)
- [ ] 配置 Vercel。
- [ ] 設置 CI/CD (GitHub Actions)。
- [ ] 部署到生產環境。
- [ ] 準備發布資料。

---

## 📚 **核心文件結構**
- `src/main.tsx` - 應用入口。
- `src/App.tsx` - 根組件。
- `src/store/` - Zustand Slices。
- `src/components/` - React 組件。
- `src/lib/` - 工具庫。
- `src/editor/` - Tiptap 編輯器組件。
- `src/hooks/` - 自定義 Hooks。
- `src/utils/` - 工具函數。
- `src/constants/` - 常量。

---

## 🎯 **下一步**
1. **生成核心代碼**：我將生成項目初始化、基礎佈局和 Tiptap 編輯器的核心代碼。
2. **提交到 GitHub**：將新的 Web Editor 項目代碼和規劃推送到新的 GitHub 倉庫。

**準備好嗎？** 我將立即開始生成核心代碼。
